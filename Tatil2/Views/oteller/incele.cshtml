@model List<Tatil2.Models.Oda>

<style>


	.baslik1 {
		;
		font-size: 24px;
		text-decoration: none;
		color: #aad665;
		flex: 1;
		text-align: center;
	}



	.oda-listesi li {
		position: relative;
	}

	/* 	.form-check {
			position: absolute;
			right: 20px;
			bottom: 20px;
			display: flex;
			align-items: center;
			gap: 8px;
		}
	 */

	.odaradio {
		width: 20px;
		height: 17px;
		margin-right: -10px;
		margin-top: 21px;
		accent-color: #aad665;
	}


	.odasec {
		font-size: 18px;
		color: #aad665;
		font-weight: bold;
		cursor: pointer;
		margin: 16px;
		margin-bottom: -8px;
	}

	.otel-baslik {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 10px;
	}

	.otel-adi {
		font-size: 24px;
		font-weight: bold;
		margin: 0;
	}

	.ortalama-puan {
		font-weight: bold;
		color: #aad665;
		font-size: 40px;
		margin-bottom: 10px; /* örnek: altın rengi */
	}

	main {
		background-color: white;
		margin: 60px;
		padding: 30px;
	}

	.otel {
		background-color: #f8f9fa;
		border: 1px solid #dee2e6;
		border-radius: 10px;
		padding: 20px;
		margin-bottom: 30px;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	}

		.otel img {
			width: 100%;
			max-height: 300px;
			object-fit: cover;
			border-radius: 8px;
			margin-bottom: 15px;
		}

		.otel h3 {
			color: #aad665;
			font-size: 40px;
			margin-bottom: 10px;
		}

		.otel p {
			font-size: 16px;
			color: #333;
		}

	ul {
		list-style-type: none;
		padding: 0;
	}

	.oda-listesi li {
		display: flex;
		position: relative;
		gap: 20px;
		background-color: #f1f1f1;
		margin-bottom: 20px;
		padding: 20px;
		border-radius: 10px;
		box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
		align-items: flex-start; /* Satırları hizalar */
	}

		.oda-listesi li img {
			width: 220px;
			height: 150px;
			object-fit: cover;
			border-radius: 8px;
			flex-shrink: 0;
		}

		.oda-listesi li .oda-detay {
			flex: 1;
			display: flex;
			flex-direction: column;
			gap: 8px;
		}

		.oda-listesi li h3 {
			margin: 0;
			font-size: 22px;
			color: #343a40;
		}

		.oda-listesi li p {
			margin: 0;
			color: #555;
			font-size: 15px;
		}

		.oda-listesi li .gun {
			position: absolute;
			right: 11px;
			top: 85px;
			color: #343a40;
			font-size: 14px;
		}
		.oda-listesi li .fiyat {
			position: absolute;
			right: 10px;
			top: 20px;
			color: #343a40;
			font-size: 22px;
		}

		.oda-listesi li .form-check {
			position: absolute;
			right: 10px;
			bottom: 10px;
			display: flex;
			align-items: center;
		}

		.oda-listesi li .form-check-label {
			font-weight: bold;
			font-size: 16px;
			color: #aad665;
		}

		.oda-listesi li.secili {
			border: 3px solid #aad665;
			box-shadow: 0 0 10px rgba(170, 214, 101, 0.7);
		}

	.yorumlar {
		margin-top: 47px;
		margin-bottom: 20px;
		background-color: #fff;
		padding: 20px;
		border-left: 5px solid #aad665;
		border-radius: 8px;
		box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
	}

		.yorumlar h4 {
			font-size: 18px;
			margin-bottom: 10px;
			color: #343a40;
			border-bottom: 1px solid #ddd;
			padding-bottom: 5px;
		}

		.yorumlar ul {
			list-style-type: none;
			padding-left: 0;
			margin: 0;
		}

	.yorum {
		margin-bottom: 12px;
		padding-bottom: 10px;
		border-bottom: 1px dashed #ccc;
	}

		.yorum p {
			margin: 4px 0;
			font-size: 14px;
			color: #444;
		}

			.yorum p strong {
				color: #6c757d;
			}

		.yorum .yorum-yapan {
			font-style: italic;
			font-size: 13px;
			color: #888;
			margin-top: 4px;
		}

	.yorum-yok {
		font-style: italic;
		font-size: 14px;
		color: #999;
		margin-top: 10px;
	}




	/* 	#rezervasyonLink {
			margin-top: 30px;
			padding: 12px 25px;
			font-size: 18px;
			background-color: #aad665;
			color: white;
			border-radius: 8px;
			transition: background-color 0.3s ease;
		} */

	/* #rezervasyonLink:hover {
				background-color: #aad665;
				color: #fff;
				text-decoration: none;
			} */

	#hataMesaji {
		margin-top: 15px;
		font-size: 16px;
	}

	/* .fiyat {
			color: #aad665;
			font-size: 18px;
			background-color: #eaffea;
			padding: 6px 10px;
			border-radius: 5px;
			display: inline-block;
		} */

</style>


@if (Model != null && Model.Any() && Model.First().Otel != null)
{
	var otel = Model.First().Otel;

	<h2 class="baslik1">Otel Bilgileri</h2>
	<div class="otel">
		<div class="otel-baslik">
			<h3 class="otel-adi">@otel.Ad</h3>
			<span class="ortalama-puan">@ViewBag.OrtalamaPuan / 10</span>
		</div>
		<img src="@otel.Poster" alt="Otel Resmi" class="img-fluid" />
		<p><strong>Konum:</strong> @otel.Konum</p>
		<p>@otel.Aciklama</p>
	</div>
}

else
{
	<p>Otel bilgileri bulunamadı.</p>
}



<h2 class="baslik1">Odalar</h2>



@if (Model != null && Model.Any())
{
	<ul class="oda-listesi">
		@foreach (var Oda in Model)
		{
			<li class="oda-karti">
				<img src="@Oda.OdaFoto" alt="@Oda.OdaAd" class="img-fluid oda-foto" />
				<div class="oda-detay">
					<h3>@Oda.OdaAd</h3>
					<p><strong>Açıklama:</strong> @Oda.OdaAciklama</p>
					<p><strong>Kapasite:</strong> @Oda.KisiSayisi</p>
					@if (Oda.OdaStok >= 3)
					{
						<p> </p>
					}
					else
					{
						<p style="color:red;"><strong>Son @Oda.OdaStok oda</strong></p>
					}					
					<p class="fiyat"><strong>@Oda.OdaFiyat ₺</strong></p>

					<p class="gun"><strong> Günlük fiyat:</strong> @Oda.OdaFiyat.ToString("0.##") ₺</p>
					

					

					<div class="form-check">
						<input class="odaradio" type="radio" name="SelectedOdaId" value="@Oda.Id" id="oda_@Oda.Id">
						<label class="odasec" for="oda_@Oda.Id">Odayı Seç</label>
					</div>

					@if (Oda.Yorum != null && Oda.Yorum.Any())
					{
						<div class="yorumlar">
							<h4>Yorumlar</h4>
							<ul>
								@foreach (var yorum in Oda.Yorum
													.OrderByDescending(y => y.Yazi)
													.Take(3))

								{
									<li class="yorum">
										<p><strong>Puan:</strong> @yorum.Puan / 10</p>
										<p>@yorum.Yazi</p>
										<p class="yorum-yapan"> <em>- @(yorum.Musteri != null ? yorum.Musteri.Ad + " " + yorum.Musteri.Soyad : "Anonim")</em></p>
									</li>
								}
							</ul>
						</div>
					}
					else
					{
						<p class="yorum-yok">Bu oda için henüz yorum yapılmamış.</p>
					}
				</div>
			</li>
		}
	</ul>
}
else
{
	<p>Bu otelde henüz oda bilgisi bulunmamaktadır.</p>
}


<p id="hataMesaji" class="text-danger" style="display: none;">Bu tarihlerde oda müsait değil, lütfen başka bir tarih seçin.</p>

<a href="#" id="rezervasyonLink" class="btn btn-primary">Rezervasyon Yap</a>

<script>
	document.querySelectorAll('input[name="SelectedOdaId"]').forEach(radio => {
		radio.addEventListener("change", function () {
			// Seçili kart vurgusu
			document.querySelectorAll(".oda-listesi li").forEach(li => li.classList.remove("secili"));
			this.closest("li")?.classList.add("secili");
			// Fiyatları yeniden hesapla
			fiyatlariGuncelle();
		});
	});

	document.addEventListener("DOMContentLoaded", function () {
		const rezervasyonLink = document.getElementById("rezervasyonLink");
		const hataMesaji = document.getElementById("hataMesaji");

		document.querySelectorAll('input[name="SelectedOdaId"]').forEach(odaSecim => {
			odaSecim.addEventListener("change", checkAvailability);
		});

		rezervasyonLink.addEventListener("click", function (e) {
			e.preventDefault();
			const odaId = document.querySelector('input[name="SelectedOdaId"]:checked')?.value;
			if (!odaId) return alert("Lütfen bir oda seçin.");
			const baslangic = "@ViewBag.BaslangicTarihi";
			const bitis = "@ViewBag.BitisTarihi";
			const kisiSayisi = "@ViewBag.KisiSayisi";
			window.location.href = `/Rezervasyon/Tamamla?odaId=${odaId}&baslangic=${baslangic}&bitis=${bitis}&kisiSayisi=${kisiSayisi}`;
		});

		function checkAvailability() {
			const odaId = document.querySelector('input[name="SelectedOdaId"]:checked')?.value;
			if (!odaId) {
				rezervasyonLink.classList.add("disabled");
				hataMesaji.style.display = "none";
				return;
			}
			fetch(`/Rezervasyon/OdaMusaitMi?odaId=${odaId}`)
				.then(r => r.json())
				.then(data => {
					if (data.musait) {
						rezervasyonLink.classList.remove("disabled");
						hataMesaji.style.display = "none";
					} else {
						rezervasyonLink.classList.add("disabled");
						hataMesaji.style.display = "block";
					}
				});
		}

		function fiyatHesapla(orjinalFiyat, kisiSayisi, baslangic, bitis) {
			// 1) Kişi sayısı ek ücreti
			let fiyat = orjinalFiyat * (1 + 0.1 * Math.max(0, kisiSayisi - 1));
			// 2) Tarihe göre %30 ek
			const bas = new Date(baslangic), bit = new Date(bitis);
			let yazZam = false;
			for (let d = new Date(bas); d < bit; d.setDate(d.getDate() + 1)) {
				const ay = d.getMonth() + 1;
				if (ay >= 7 && ay <= 9) { yazZam = true; break; }
			}
			if (yazZam) fiyat *= 1.3;
			// 3) Gün sayısını al (bit - bas)
			const msPerGun = 1000 * 60 * 60 * 24;
			const geceSayisi = Math.round((bit - bas) / msPerGun);
			// Toplam = gecelik fiyat * geceSayisi
			return (fiyat * geceSayisi).toFixed(2);
		}

		function fiyatlariGuncelle() {
			const kisiSayisi = parseInt("@ViewBag.KisiSayisi") || 1;
			const baslangic = "@ViewBag.BaslangicTarihi";
			const bitis = "@ViewBag.BitisTarihi";

			document.querySelectorAll('.oda-listesi li').forEach(li => {
				const fiyatElem = li.querySelector('.fiyat strong');
				if (!fiyatElem) return;
				const orjinal = parseFloat(fiyatElem.getAttribute('data-orjinal-fiyat'));
				if (isNaN(orjinal)) return;
				const yeni = fiyatHesapla(orjinal, kisiSayisi, baslangic, bitis);
				fiyatElem.textContent = `${yeni} ₺`;
			});
		}

		// İlk yükeleme: orijinal fiyatları sakla ve güncelle
		document.querySelectorAll('.oda-listesi li').forEach(li => {
			const fe = li.querySelector('.fiyat strong');
			if (fe && !fe.hasAttribute('data-orjinal-fiyat')) {
				const val = parseFloat(fe.textContent.replace('₺','').trim());
				fe.setAttribute('data-orjinal-fiyat', val);
			}
		});
		fiyatlariGuncelle();
	});
</script>


