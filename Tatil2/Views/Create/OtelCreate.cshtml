@model Tatil2.Models.OtelCreateDTO

@{
	ViewData["Title"] = "Otel Ekle";
}

<h1>Otel Ekle</h1>

@if (TempData["SuccessMessage"] != null)
{
	<div class="alert alert-success">
		@TempData["SuccessMessage"]
	</div>
}

@if (TempData["ErrorMessage"] != null)
{
	<div class="alert alert-danger">
		@TempData["ErrorMessage"]
	</div>
}

<form asp-action="OtelCreate" onsubmit="Submit" method="post" enctype="multipart/form-data">
	<div class="form-group">
		<label asp-for="Ad" class="control-label"></label>
		<input asp-for="Ad" class="form-control" />
		<span asp-validation-for="Ad" class="text-danger"></span>
	</div>

	<div class="form-group">
		<label asp-for="Aciklama" class="control-label"></label>
		<textarea asp-for="Aciklama" class="form-control"></textarea>
		<span asp-validation-for="Aciklama" class="text-danger"></span>
	</div>

	<div class="form-group">
		<label asp-for="Poster" class="control-label"></label>
		<input type="file" name="Poster" class="form-control" />
		<span asp-validation-for="Poster" class="text-danger"></span>
	</div>

	<div class="form-group">
		<label asp-for="Konum" class="control-label"></label>
		<input asp-for="Konum" class="form-control" />
		<span asp-validation-for="Konum" class="text-danger"></span>
	</div>

	<div class="form-group">
		<label class="control-label">Şehir</label>
		<select asp-for="SehirId" id="SehirId" class="form-control">
			<option value="">Şehir Seçiniz</option>
			@foreach (var sehir in ViewBag.Sehirler as List<Tatil2.Models.Sehir>)
			{
				<option value="@sehir.Id">@sehir.Name</option>
			}
		</select>
		<span asp-validation-for="SehirId" class="text-danger"></span>
	</div>

	<div class="form-group">
		<label class="control-label">İlçe</label>
		<select asp-for="İlceId" id="İlceId" class="form-control" disabled>
			<option value="">İlçe Seçiniz</option>
		</select>
		<span asp-validation-for="İlceId" class="text-danger"></span>
	</div>


	<h3 class="control-label">Tag Kategoriler</h3>
	<div>
		@if (ViewBag.TagKategori != null)
		{
			var tagKategoriList = ViewBag.TagKategori as List<Tatil2.Models.TagKategori>;
			if (tagKategoriList != null && tagKategoriList.Count > 0)
			{
				@foreach (var tagKategori in tagKategoriList)
				{
					<h6>@tagKategori.Ad</h6>
					@foreach (var tag in tagKategori.Tag)
					{
						<div class="form-check">
							<input class="form-check-input" type="checkbox" id="@tag.Ad" name="SelectedTagId" value="@tag.Id" />
							<label class="form-check-label" for="@tag.Ad">@tag.Ad</label>
						</div>
					}
				}
			}
		}
		else
		{
			<p>No tag categories available.</p>
		}


		<div id="odalar">
			<div class="oda">
				<h4>Oda 1</h4>
				<label for="OdaAd">Oda Adı</label>
				<input type="text" name="Odalar[0].OdaAd" class="form-control" />

				<label for="OdaAciklama">Oda Açıklaması</label>
				<input type="text" name="Odalar[0].OdaAciklama" class="form-control" />

				<label for="OdaFiyat">Fiyat</label>
				<input type="number" name="Odalar[0].OdaFiyat" class="form-control" />

				<label for="KisiSayisi">Kişi Sayısı</label>
				<input type="number" name="Odalar[0].KisiSayisi" class="form-control" />

				<label for="OdaStok">Oda Stok</label>
				<input type="number" name="Odalar[0].OdaStok" class="form-control" />

				<label for="OdaFoto">Oda Fotoğrafı</label>
				<input type="file" name="Odalar[0].OdaFoto" class="form-control" />
			</div>
		</div>

		<button type="button" onclick="addRoom()">Oda Ekle</button>

		<button type="submit" class="btn btn-primary">Kaydet</button>
</form>
@section Scripts {
	<script>
				function Submit(event) {
		
			event.preventDefault();

			
			const form = event.target;

			const formData = new FormData(form);

		
			fetch('@Url.Action("OtelCreate", "Create")', {
				method: 'POST',
				body: formData, 
			})
			.then(response => {
				if (!response.ok) {
					throw new Error("Ağ isteği başarısız.");
				}
				alert("Otel başarıyla eklendi!");
				
			})
			.catch(error => {
				console.error('Hata:', error);
				alert("Bir hata oluştu.");
			});
		}



		document.getElementById("SehirId").addEventListener("change", function() {
			var sehirId = this.value;
			var ilceDropdown = document.getElementById("İlceId");


			if (!sehirId) {
				ilceDropdown.innerHTML = "<option value=''>İlçe Seçiniz</option>";
				ilceDropdown.disabled = true;
				return;
			}


			ilceDropdown.disabled = false;


			fetch(`/create/GetIlceler?id=${sehirId}`)
				.then(response => response.json())
				.then(data => {

					ilceDropdown.innerHTML = "<option value=''>İlçe Seçiniz</option>";


					data.forEach(ilce => {
						var option = document.createElement("option");
						option.value = ilce.id;
						option.textContent = ilce.ad;
						ilceDropdown.appendChild(option);
					});
				})
				.catch(error => {
					console.error('Hata:', error);
					ilceDropdown.innerHTML = "<option value=''>İlçe Seçilemiyor</option>";
				});
		});
	</script>
}


<script>
	var odaCount = 1;
	function addRoom() {
		var odaDiv = document.createElement('div');
		odaDiv.classList.add('oda');
		odaDiv.innerHTML = `
			<h4>Oda ${odaCount + 1}</h4>
			<label for="OdaAd">Oda Adı</label>
			<input type="text" name="Odalar[${odaCount}].OdaAd" class="form-control" />

			<label for="OdaAciklama">Oda Açıklaması</label>
			<input type="text" name="Odalar[${odaCount}].OdaAciklama" class="form-control" />

			<label for="OdaFiyat">Fiyat</label>
			<input type="number" name="Odalar[${odaCount}].OdaFiyat" class="form-control" />

			<label for="KisiSayisi">Kişi Sayısı</label>
			<input type="number" name="Odalar[${odaCount}].KisiSayisi" class="form-control" />

			<label for="OdaStok">Oda Stok</label>
			<input type="number" name="Odalar[${odaCount}].OdaStok" class="form-control" />

			<label for="OdaFoto">Oda Fotoğrafı</label>
			<input type="file" name="Odalar[${odaCount}].OdaFoto" class="form-control" />
		`;
		document.getElementById('odalar').appendChild(odaDiv);
		odaCount++;
	}
</script>
